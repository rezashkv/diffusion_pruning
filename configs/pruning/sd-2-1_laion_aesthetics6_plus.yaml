model:
  unet:
    pretrained_model_name_or_path: stabilityai/stable-diffusion-2-1
    input_perturbation: 0.0
    revision: null
    resolution: 512
    use_ema: false
    non_ema_revision: null
    mixed_precision: null
    noise_offset: 0.0
    prediction_type: epsilon
    unet_down_blocks:
      - CrossAttnDownBlock2DHalfGated
      - CrossAttnDownBlock2DHalfGated
      - CrossAttnDownBlock2DHalfGated
      - DownBlock2DHalfGated
    unet_up_blocks:
      - UpBlock2DHalfGated
      - CrossAttnUpBlock2DHalfGated
      - CrossAttnUpBlock2DHalfGated
      - CrossAttnUpBlock2DHalfGated

    pruning_target: 0.8

  hypernet:
    hypernet_T: 0.4
    hypernet_base: 3.0
    hypernet_sparsity: 0

  quantizer:
    num_arch_vq_codebook_embeddings: 256
    arch_vq_beta: 0.25


data:
  train_data_dir: "/fs/cml-datasets/improved_aesthetics_6plus/data/"
  dataset_name: null
  data_files: null
  dataset_config_name: null
  image_column: "image"
  caption_column: "caption"
  max_train_samples: 2000000
  validation_prompts:
    - "A happy dog in the fields"
  dataloader:
    dataloader_num_workers: 0
    train_batch_size: 8
    center_crop: false
    random_flip: true


training:
  losses:
    diffusion_loss:
      snr_gamma: null

    resource_loss:
      resource_loss_type: log
      resource_loss_weight: 1.0

    quantization_loss:
      q_loss_weight: 1.0

    contrastive_clip_loss:
      contrastive_loss_temperature: 1.0
      contrastive_loss_weight: 0.1

  optim:
    hypernet_learning_rate: 0.01
    quantizer_learning_rate: 0.001
    scale_lr: false
    lr_scheduler: "cosine_with_restarts"
    lr_warmup_steps: 500
    use_8bit_adam: false
    adam_beta1: 0.9
    adam_beta2: 0.999
    adam_weight_decay: 0.01
    adam_epsilon: 1e-08
    max_grad_norm: 1.0

  hf_hub:
    push_to_hub: false
    hub_token: null
    hub_model_id: null

  logging:
    cache_dir: "/fs/nexuss-scratch/rezashkv/.cache/huggingface/"
    logging_dir: "/fs/nexus-scratch/rezashkv/research/logs/sd-pruning/"
    output_dir: "/fs/nexus-scratch/rezashkv/research/logs/sd-pruning/"
    report_to: "wandb"
    checkpointing_steps: 1000
    checkpoints_total_limit: 1
    resume_from_checkpoint: "latest"
    tracker_project_name: "text2image-dynamic-pruning"

  num_train_epochs: 100
  max_train_steps: null
  validation_epochs: 1
  gradient_accumulation_steps: 1
  gradient_checkpointing: false
  local_rank: -1
  num_inference_steps: 100
  allow_tf32: false
  enable_xformers_memory_efficient_attention: false
